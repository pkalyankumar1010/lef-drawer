(()=>{"use strict";var e={4:function(e,t,s){var i,o=this&&this.__createBinding||(Object.create?function(e,t,s,i){void 0===i&&(i=s);var o=Object.getOwnPropertyDescriptor(t,s);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,i,o)}:function(e,t,s,i){void 0===i&&(i=s),e[i]=t[s]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(i=function(e){return i=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},i(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=i(e),r=0;r<s.length;r++)"default"!==s[r]&&o(t,e,s[r]);return n(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){console.log('Congratulations, your extension "lef-viz" is now active in the web extension host!');const t=a.commands.registerCommand("lef-viz.helloWorld",()=>{a.window.showInformationMessage("Hello World from lef-viz in a web extension host!")});e.subscriptions.push(t);const s=a.commands.registerCommand("lef-viz.showPreview",async()=>{const t=a.window.activeTextEditor;if(!t)return void a.window.showErrorMessage("No LEF file open");const s=a.window.createWebviewPanel("lefPreview","LEF Preview",a.ViewColumn.Beside,{enableScripts:!0,localResourceRoots:[a.Uri.joinPath(e.extensionUri,"react-dist")]}),i=s.webview.asWebviewUri(a.Uri.joinPath(e.extensionUri,"react-dist","assets","index-CKnCRv9t.js")),o=s.webview.asWebviewUri(a.Uri.joinPath(e.extensionUri,"react-dist","assets","index-B2X0Co8W.css")),n=s.webview.asWebviewUri(a.Uri.joinPath(e.extensionUri,"react-dist","vite.svg")),r=a.Uri.joinPath(e.extensionUri,"react-dist","index.html"),l=await fetch(r.toString());let d=await l.text();d=d.replace("/assets/index-CKnCRv9t.js",i.toString()),d=d.replace("/assets/index-B2X0Co8W.css",o.toString()),d=d.replace("/vite.svg",n.toString()),s.webview.html=d;let u=!1;s.webview.onDidReceiveMessage(e=>{switch(console.log("Received message from webview:",e),e.command){case"webview-ready":console.log("Webview is ready, sending initial data"),u=!0,f();break;case"log":console.log("Webview log:",e.text);break;default:console.log("Unknown message from webview:",e)}},void 0,e.subscriptions);const f=()=>{if(!u)return void console.log("Webview not ready yet, skipping data send");const e=t.document.getText(),i=(0,c.parseLef)(e),o={type:"lef-data",data:i.vias,parsedData:i.vias};s.webview.postMessage(o),console.log("Sent LEF data to webview:",o)},p=a.workspace.onDidChangeTextDocument(e=>{e.document===t.document&&(console.log("Editor content changed, updating webview"),f())});s.onDidDispose(()=>{p.dispose()},null,e.subscriptions),setTimeout(()=>{u||(console.log("Webview not ready after timeout, sending data anyway"),u=!0,f())},1e3),setTimeout(()=>{f()},500)});e.subscriptions.push(s)},t.deactivate=function(){};const a=r(s(1398)),c=s(5138)},1398:e=>{e.exports=require("vscode")},5138:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseLef=function(e){const t=e.split(/\r?\n/),s=[],i=[];let o={},n={},r=[],a=!1;for(const e of t){const t=e.trim();if(t.startsWith("LAYER")&&!a)o={name:t.split(" ")[1]};else if(t.startsWith("TYPE")&&!a)o.type=t.split(" ")[1].replace(";","");else if(t.startsWith("WIDTH")&&!a)o.width=parseFloat(t.split(" ")[1]);else if(t.startsWith("SPACING")&&!a)o.spacing=parseFloat(t.split(" ")[1]);else if(t.startsWith("VIA"))n={name:t.split(" ")[1]},r=[],a=!0;else if(a&&t.startsWith("LAYER")){const e=t.split(" ")[1].replace(";","");r.push({layer:e,rects:[]});const s=t.match(/RECT\s+[-+]?\d*\.?\d+(?:\s+[-+]?\d*\.?\d+){3}/g);if(s)for(const e of s){const t=e.match(/[-+]?\d*\.?\d+/g);if(t){const e=t.map(parseFloat);r.length>0&&r[r.length-1].rects.push(e)}}}else if(a&&t.includes("RECT")){const e=t.match(/RECT\s+[-+]?\d*\.?\d+(?:\s+[-+]?\d*\.?\d+){3}/g);if(e)for(const t of e){const e=t.match(/[-+]?\d*\.?\d+/g);if(e){const t=e.map(parseFloat);r.length>0&&r[r.length-1].rects.push(t)}}}else if(t.startsWith("END")){const e=t.split(" ")[1];a||o.name!==e?a&&n.name===e&&(n.layers=r,i.push(n),n={},r=[],a=!1):(s.push(o),o={})}}return{layers:s,vias:i}}}},t={},s=function s(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i].call(n.exports,n,n.exports,s),n.exports}(4),i=exports;for(var o in s)i[o]=s[o];s.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();